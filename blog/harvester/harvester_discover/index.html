<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.82.0"><title>Discovering HCI Project Harvester | Kubernetes Ravings</title><meta name=twitter:card content="summary"><meta name=twitter:title content="Discovering HCI Project Harvester"><meta name=twitter:description content="Introduction to Harvester Harvester is an OSS (Open Source Software) project created by Rancher Labs (now part of SUSE) that provides a Kubernetes-based HCI (Hyper-Converged Infrastructure) solution. Its main goal is to combine many existing OSS projects to offer an easy-to-use platform for software defined infrastructure. This includes :
 Compute Virtualization using KubeVirt Software Defined Block Storage using Longhorn Software Defined Networking using Multus Snapshotting and Templates using MinIO  The objective of Harvester is to use the same platform for both containerized workloads as well as more traditional VM-based workloads, and still make the latter able to use Kubernetes features like load balancing, service discovery, etc."><meta property="og:title" content="Discovering HCI Project Harvester"><meta property="og:description" content="Introduction to Harvester Harvester is an OSS (Open Source Software) project created by Rancher Labs (now part of SUSE) that provides a Kubernetes-based HCI (Hyper-Converged Infrastructure) solution. Its main goal is to combine many existing OSS projects to offer an easy-to-use platform for software defined infrastructure. This includes :
 Compute Virtualization using KubeVirt Software Defined Block Storage using Longhorn Software Defined Networking using Multus Snapshotting and Templates using MinIO  The objective of Harvester is to use the same platform for both containerized workloads as well as more traditional VM-based workloads, and still make the latter able to use Kubernetes features like load balancing, service discovery, etc."><meta property="og:type" content="article"><meta property="og:url" content="http://blog.belgaied.name/blog/harvester/harvester_discover/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-03-17T13:07:15+01:00"><meta property="article:modified_time" content="2021-03-17T13:07:15+01:00"><link href=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css rel=stylesheet integrity=sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.0.13/css/all.css integrity=sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp crossorigin=anonymous><link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel=stylesheet><link href=/css/medium.css rel=stylesheet><link href=/css/additional.css rel=stylesheet></head><body><nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down"><div class="container pr-0"><a class=navbar-brand href=http://blog.belgaied.name//><span style=font-family:Merriweather>Kubernetes Ravings</span></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarMediumish aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarMediumish><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/blog>Blog</a></li></ul></div></div></nav><div class=site-content><div class=container><div class=mainheading><h1 class=sitetitle>Kubernetes Ravings</h1><p class=lead></p></div><div class=main-content><div class=container><div class=row><div class="col-md-2 pl-0"><div class="share sticky-top sticky-top-offset"><p>Share</p><ul><li class="ml-1 mr-1"><a target=_blank href="https://twitter.com/intent/tweet?text=Discovering%20HCI%20Project%20Harvester&url=http%3a%2f%2fblog.belgaied.name%2fblog%2fharvester%2fharvester_discover%2f" onclick="return window.open(this.href,'twitter-share','width=550,height=435'),!1"><i class="fab fa-twitter"></i></a></li><li class="ml-1 mr-1"><a target=_blank href="https://facebook.com/sharer.php?u=http%3a%2f%2fblog.belgaied.name%2fblog%2fharvester%2fharvester_discover%2f" onclick="return window.open(this.href,'facebook-share','width=550,height=435'),!1"><i class="fab fa-facebook-f"></i></a></li><li class="ml-1 mr-1"><a target=_blank href="https://www.xing.com/spi/shares/new?url=http%3a%2f%2fblog.belgaied.name%2fblog%2fharvester%2fharvester_discover%2f" onclick="return window.open(this.href,'xing-share','width=550,height=435'),!1"><i class="fab fa-xing"></i></a></li></ul></div></div><div class="col-md-9 flex-first flex-md-unordered"><div class=mainheading><div class="row post-top-meta"><div class="col-xs-12 col-md-3 col-lg-2 text-center text-md-left mb-4 mb-md-0 md-nopad-right"><img class=author-thumb src=/images/profile.png alt="Mohamed Belgaied Hassine"></div><div class="col-xs-12 col-md-9 col-lg-10 text-center text-md-left md-nopad-left"><a target=_blank class=link-dark>Mohamed Belgaied Hassine</a><br><span class=author-description>Creator of this blog.<br><i class="far fa-star"></i>
Mar 17, 2021
<i class="far fa-clock clock"></i>
8 min read</span></div></div><h1 class=posttitle>Discovering HCI Project Harvester</h1></div><div class=article-post><h1 id=introduction-to-harvester>Introduction to Harvester</h1><p>Harvester is an OSS (Open Source Software) project created by Rancher Labs (now part of SUSE) that provides a Kubernetes-based HCI (Hyper-Converged Infrastructure) solution. Its main goal is to combine many existing OSS projects to offer an easy-to-use platform for software defined infrastructure. This includes :</p><ul><li>Compute Virtualization using <a href=https://kubevirt.io/>KubeVirt</a></li><li>Software Defined Block Storage using <a href=https://longhorn.io>Longhorn</a></li><li>Software Defined Networking using <a href=https://github.com/k8snetworkplumbingwg/multus-cni>Multus</a></li><li>Snapshotting and Templates using <a href=https://min.io/>MinIO</a></li></ul><p>The objective of Harvester is to use the same platform for both containerized workloads as well as more traditional VM-based workloads, and still make the latter able to use Kubernetes features like load balancing, service discovery, etc.</p><h1 id=harvester-features>Harvester features</h1><p>The main features of Harvester include but are not limited to:</p><ul><li>Store OS images and VM templates</li><li>Automatic backups of VMs</li><li>Bridge Networking and Cluster Networking for VMs</li><li>Management of SSH Public keys</li><li>Clustering of virtualization hosts</li><li>Linux and Windows guests</li><li>Console Access from the browser</li><li>VNC console for guests</li><li>etc.</li></ul><h1 id=how-to-try-harvester>How to try Harvester</h1><h2 id=downloading-harvester>Downloading Harvester</h2><p>In order to try out Harvest, you will first need to download the ISO file of the latest release from <a href=https://github.com/rancher/harvester>Harvester&rsquo;s Github page</a>.</p><p>As of writing this blog, the latest version is <a href=https://github.com/rancher/harvester/releases/tag/v0.1.0>v0.1.0</a>.</p><p>You will need to download the file <code>harvester-amd64.iso</code>.</p><h2 id=installing-harvester>Installing Harvester</h2><p>Depending on where you would like to install Harvester, you might have different approaches. For instance, if you would like to deploy Harvester on Equinix Metal, you will need the iPXE installation. In this article, I will only describe the installation using the ISO on a Bare Metal server, or any machine. I do it on my Intel NUC. That means, I use a tool such as <a href=https://rufus.ie/en_IE.html>Rufus</a> to create a USB drive from the ISO. Now, I can plug my USB drive to my NUC and get going with the installation.</p><p>After powering up the server with the USB drive inserted, the GRUB menu for installing Harvester should appear:</p><p><img src=/harv_screenshots/Harvester_install1_Grub.png alt="Grub Install Harvester"></p><p>Type <code>Enter</code> to continue. After that, a menu should appear to choose between creating a new Harvester Cluster or joining an existing one.</p><p><img src=/harv_screenshots/Harvester_Install2_createNewCluster.png alt="First Step - Create New Cluster"></p><p>Indeed, Harvester is an HCI solution can deploy across a cluster of machines. In order to do so, the first machine on which you install Harvester will create the cluster, and the following ones will join the cluster. In this case, we will create a single-machine Harvester cluster, so we will choose <code>Create a new Harvester cluster</code>, then type <code>Enter</code>.</p><p>The next screen is about choosing the Hard Drive that will be used for the installation.</p><p><img src=/harv_screenshots/Harvester_Install3_chooseDisk.png alt="Choose your main Hard Drive"></p><p>In this case, we choose sda. Then, you need to type a <em>token</em>. A <em>token</em> is a character string made up of letters, digits and symbols that can be used to add new nodes to the Harvester cluster. The token is first defined on the master node, nodes that need to join the cluster will need to have the master&rsquo;s url and the <em>token</em>. You can choose whatever token you would like on the master, but I recommend you choose a complex and unique one, to avoid having machines joining your Harvester master by mistake.</p><p><img src=/harv_screenshots/Harvester_Install4_token.png alt="Insert a token"></p><p>After inserting the token, you need to define a password for your <em>root</em> user on the Harvester node&rsquo;s OS. Indeed, Harvester is based on <a href=https://k3os.io/>K3OS</a> which is a lightweight Linux distribution including <a href=https://k3s.io/>K3s</a>, the lightweight Kubernetes distribution.</p><p><img src=/harv_screenshots/Harvester_Install5_Password.png alt="Set up first password for root user"></p><p>This password can be used when connecting directly to the node without private key. However, the next step, will define an SSH public key to be used for remote SSH access. The public key can automatically be provided using a URL, like the ones available for Github profiles. Let&rsquo;s say you have a Github user named <em>someone</em>, for whom you added a public key <a href=https://github.com/settings/keys>here</a>. Github will make these public keys available using the url <code>https://github.com/someone.keys</code>.</p><p><img src=/harv_screenshots/Harvester_Install6_HostPublicKey.png alt="Set up SSH Public Key for rancher user"></p><p>Now, you will tell Harvester which network interface will be used as a Management Network, since many machine might have multiple network interfaces. The management network is the network that will be used to advertise Harvester&rsquo;s endpoint, or the URL to which you will connect to Harvester.</p><p><img src=/harv_screenshots/Harvester_Install7_NetworkInterface.png alt="Choosing the Management Network interface"></p><p>The next screen will suggest you to insert proxy information, please go ahead and give any necessary proxy information to access the internet from this machine. Internet access can be used to download VM or ISO images inside of Harvester, as well as upgrades, etc. In my case, there is no proxy to configure, that&rsquo;s why I will leave it blank.</p><p><img src=/harv_screenshots/Harvester_Install8_Proxy.png alt="Choosing the Management Network interface"></p><p>The next step will give you the possibility to customize your installation using <a href=https://cloudinit.readthedocs.io/en/latest/>Cloud-Init</a>. You just need to give a URL to a cloud-init config yaml file when asked.</p><p><img src=/harv_screenshots/Harvester_Install9_CloudInit.png alt="Cloud-init configuration"></p><p>Formatting the disk comes next with the following screen.</p><p><img src=/harv_screenshots/Harvester_Install10_FormatDisk.png alt="Format the disk"></p><p>Now finally, Harvester installation will begin.</p><p><img src=/harv_screenshots/Harvester_Install11_Installing.png alt=Installing&mldr;></p><p>Now, after the installation is finished, the server will reboot and start harvester, first by showing GRUB:</p><p><img src=/harv_screenshots/Harvester_Start1_Grub.png alt="First Start, Grub&mldr;"></p><p>then, after everything is started, you will see the following screen:</p><p><img src=/harv_screenshots/Harvester_Start2_DONE.png alt="First Start, Running&mldr;"></p><p>At this point, you can note down the address at which you can access Harvester, and leave the machine as headless and switch to another one to access Harvester&rsquo;s UI. If something is wrong with remote access or the UI, you can always come back to this machine, connect a keyboard and type <code>F12</code> and then put the password for the <code>root</code> user that you setup during installation. You will then have a command prompt.</p><p><img src=/harv_screenshots/Harvester_Start3_Shell.png alt="Harvester shell"></p><h2 id=using-harvesters-ui>Using Harvester&rsquo;s UI</h2><p>Once Harvester is up and running, you should have noted down the URL to connect to it. In the release v0.1.0, the address should use the port <code>8443</code>. In my case the address is <code>https://192.168.0.104:8443</code>. Let&rsquo;s connect to that address:</p><p><img src=/harv_screenshots/Harvester_UI1_LOGIN.png alt="Harvester Login"></p><p>The administrator user is <code>admin</code> and the default password is <code>password</code>, but this can be changed after the first login. Let&rsquo;s put the username and password and click on the <code>SIGN IN</code> button. Now the Harvester Dashboard is shown as follows:</p><p><img src=/harv_screenshots/Harvester_UI2_Dashboard.png alt="Harvester Dashboard"></p><p>The Harvester Dashboard might look similar to the Cluster Explorer in Rancher v2.5. On the left menu, you can see <code>Hosts</code>, <code>Virtual Machines</code>, <code>Volumes</code>, <code>Images</code> and <code>Advanced</code>.</p><ul><li><em>Hosts</em>: This will show you the Hosts on your Harvester Cluster. Right now, you should see only one host, which is the master of your single-node cluster.</li><li><em>Virtual Machines</em>: This is the place where you will create new VMs on Harvester. Right now, it is empty.</li><li><em>Volumes</em>: These are the storage volumes that will be used by the VMs</li><li><em>Images</em>: These will be the ISO and Cloud image files for the OSes to be used by your VMs.</li><li><em>Advanced</em>: This menu will show some sub menu items to configure things like VM Templates, Bridge Networks, SSH Keys to use with your VMS, Users, and Settings.</li></ul><h2 id=pre-requisites-for-creating-first-vm>Pre-requisites for creating first VM</h2><p>In order to create your first VM, you need to first create an OS image under the <em>Images</em> menu. In the <em>Images</em> view, click on the <em>Create</em> button.</p><p><img src=/harv_screenshots/Harvester_UI3_Images.png alt="Harvester Images Empty"></p><p>Then, put a cloud image or ISO of your choice for the OS. In my case, I am using Ubuntu Bionic Minimal Cloud Image available <a href=https://cloud-images.ubuntu.com/minimal/releases/bionic/release/ubuntu-18.04-minimal-cloudimg-amd64.img>here</a>.</p><p><img src=/harv_screenshots/Harvester_UI4_ImagesUbuntuURL.png alt="Harvester Images Ubuntu Bionic"></p><p>then click on <em>Create</em>. This will download the image and store it in Harvester&rsquo;s Image Store for further use. After a few seconds, you should see the following screen with an image state <em>Imported</em> in green.</p><p><img src=/harv_screenshots/Harvester_UI5_ImagesUbuntuImported.png alt="Harvester Images Ubuntu Imported"></p><p>Now, let&rsquo;s import the SSH public key for SSH access to the VMs by clicking on the <em>SSH Keys</em> sub-menu in the <em>Advanced</em> main menu.</p><p><img src=/harv_screenshots/Harvester_UI6_SSHEmpty.png alt="Harvester SSH Empty"></p><p>Click on <em>Create</em> then paste your public key in <em>SSH Key</em> field and give it a name in the <em>Name</em> field, then click on <em>Create</em>.</p><p><img src=/harv_screenshots/Harvester_UI7_SSHPublicKey.png alt="Harvester SSH Key"></p><p>After the create is successfully created, you should see a screen showing it with the State <em>Validated</em> on left hand side as the following.</p><p><img src=/harv_screenshots/Harvester_UI8_SSHKeyValidated.png alt="Harvester SSH Key Validated"></p><p>Now, we are ready for creating a VM.</p><h2 id=creating-the-first-vm>Creating the first VM</h2><p>Now, in order to actually create the VM we will click on the <em>Virtual Machines</em> menu to see the following view.</p><p><img src=/harv_screenshots/Harvester_UI9_VMEmpty.png alt="Harvester VM Menu empty"></p><p>Then, click on <em>Create</em> to open the VM creation wizard. In the <em>Name</em> field give a VM name, you can add a description in the <em>Description</em> field. Add the required CPU number in the <em>CPU</em> field and required memory size in GiB in the <em>Memory</em> field, and choose the OS Image in the <em>Image</em> field as well as the SSH Key in the <em>SSHKey</em> field.</p><p><img src=/harv_screenshots/Harvester_UI10_VMBasics.png alt="Harvester VM Basics"></p><p>In this wizard&rsquo;s <em>Volumes</em> sub-menu you can choose to add an additional Disk volume to your VM.</p><p><img src=/harv_screenshots/Harvester_UI11_VMStorage.png alt="Harvester VM Storage"></p><p>In the <em>Networks</em> sub-menu, you can override the network settings, for example to setup a bridge network, we will NOT do this here.</p><p><img src=/harv_screenshots/Harvester_UI12_VMNetwork.png alt="Harvester VM Network"></p><p>You also add some cloud-init configuration if you wish under the <em>Advanced Options</em> sub-menu.</p><p><img src=/harv_screenshots/Harvester_UI13_VMAdvanced.png alt="Harvester VM Advanced"></p><p>After clicking on <em>Create</em> and waiting for a couple of minutes, you should see the following screen.</p><p><img src=/harv_screenshots/Harvester_UI14_VMRunning.png alt="Harvester VM Running"></p><p>Harvester shows the VM as being in the <code>Running</code> state in green, and offers the possibility to connect to use using a serial console by clicking on the arrow near the <em>Console</em> button and then on <em>Open in Serial Console</em>.</p><p><img src=/harv_screenshots/Harvester_UI15_VMConsoleMenu.png alt="Harvester VM Console Menu"></p><p>Now, a command prompt should opne with a login prompt, this a serial access to the VM, this does not work with your private key, so you need to have set a password in cloud-init or your Cloud image.</p><p><img src=/harv_screenshots/Harvester_UI16_VMSerialConsole.png alt="Harvester VM Serial Console"></p><p>Congratulations! You now have created a VM in your new Harvester Installation, and you were able to access the VM from the browser.</p><h2 id=conclusion>Conclusion</h2><p>Though this article seems long because of the screenshots, you see that the installation of Harvester is pretty straightforward and that the creation of a new VM is possible after a couple of minutes. You also see that there is no need to have any understanding of Kubernetes or how Kubernetes works to install and use Harvester.
This first article only scratches the surface of what is possible to do using Harvester. I will try to deep dive into more Harvester topics in the futures. If you have any questions, please post them in the comments sections. I will be more than happy to answer them.</p></div><div class=after-post-tags><ul class=tags></ul></div><div class="row PageNavigation d-flex justify-content-between font-weight-bold"><div class=clearfix></div></div></div></div></div></div></div><div class="jumbotron fortags"><div class="d-md-flex h-100"><div class="col-md-4 transpdark align-self-center text-center h-100"><div class="d-md-flex align-items-center justify-content-center h-100"><h2 class="d-md-block d-none align-self-center py-1 font-weight-light">Explore <span class="d-none d-md-inline">â†’</span></h2></div></div><div class="col-md-8 p-5 align-self-center text-center"></div></div></div><footer class=footer><div class=container><div class=row><div class="col-md-6 col-sm-6 text-center text-lg-left">&copy; Copyright Mohamed Belgaied Hassine - All rights reserved</div><div class="col-md-6 col-sm-6 text-center text-lg-right"><a target=_blank rel=noopener href=https://www.wowthemes.net>Mediumish Theme</a> by WowThemes.net</div></div></div></footer></div><script src=https://code.jquery.com/jquery-3.4.1.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js integrity=sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js integrity=sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM crossorigin=anonymous></script><script src=/js/mediumish.js></script></body></html>